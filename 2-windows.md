# ü™ü 2      Windows

## 2.1         –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–Ω—è—Ç–∏–µ. –ò–∑—É—á–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –∫ –æ–±—ä–µ–∫—Ç–∞–º

#### –ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ü–û –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

–î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ä–∞–±–æ—á–µ–π —Å—Ç–∞–Ω—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ü–û:

VMWare Workstation (–∏–ª–∏ VMware Workstation Pro).

–î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ä–∞–±–æ—á—É—é —Å—Ç–∞–Ω—Ü–∏—é –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ Win10.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–ª–∞–¥—á–∏–∫–∞ —è–¥—Ä–∞ Windows**

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä—è–¥–∞ –∑–∞–¥–∞–Ω–∏–π –¥–∞–Ω–Ω–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–ª–∞–¥—á–∏–∫–∞ —è–¥—Ä–∞ –û–° Windows.

–î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏ —è–¥—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

1\.       –£–∫–∞–∑–∞—Ç—å –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏ —è–¥—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π –æ–±–æ–ª–æ—á–∫–µ, –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–∏—Å—Ç–µ–º—ã, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É **bcdedit ‚Äìdebug on**. –ü–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É.

2\.       –ù–∞—Å—Ç—Ä–æ–∏—Ç—å WinDbg –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É —Å–∏–º–≤–æ–ª–æ–≤ —è–¥—Ä–∞ —Å —Å–∞–π—Ç–∞ Microsoft. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫—Ä—ã—Ç—å —è—Ä–ª—ã–∫ WinDbg (x64) –∏ –≤ —Å—Ç—Ä–æ–∫–µ ¬´Target¬ª –¥–æ–±–∞–≤–∏—Ç—å –∫ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–∞–ø—É—Å–∫–∞: **-y "srv\*c:\symbols\*https://msdl.microsoft.com/download/symbols"**, –≥–¥–µ c:\symbols ‚Äì –ø—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∫—ç—à—É —Å–∏–º–≤–æ–ª–æ–≤ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π), –∞ [https://msdl.microsoft.com/download/symbols](https://msdl.microsoft.com/download/symbols) - URL —Å–µ—Ä–≤–µ—Ä–∞ —Å–∏–º–≤–æ–ª–æ–≤ Microsoft.

<figure><img src=".gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

3\.       –ó–∞–ø—É—Å—Ç–∏—Ç—å WinDbg –∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ —Å–µ–∞–Ω—Å –æ—Ç–ª–∞–¥–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —è–¥—Ä–∞ (File ‚Üí Kernel debug, –≤–∫–ª–∞–¥–∫–∞ Local). **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –∑–∞–π–º–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è, —Ç–∞–∫ –∫–∞–∫ —Ñ–æ–Ω–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ —è–¥—Ä–∞ —Å —Å–∞–π—Ç–∞ Microsoft. –ü—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.

4\.       –í –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –æ—Ç–ª–∞–¥—á–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É lml –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å –æ—Ç–ª–∞–¥–∫–∏ —è–¥—Ä–∞ (nt) ‚Äì –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º—É –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ.

<figure><img src=".gitbook/assets/image (44).png" alt=""><figcaption></figcaption></figure>

### **–ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ—Ç –∏–º–µ–Ω–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã**

–ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ—Ç –∏–º–µ–Ω–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ —É—Ç–∏–ª–∏—Ç—ã psexec –∏–∑ –ø–∞–∫–µ—Ç–∞ sysinternals, –ø—Ä–∏ —ç—Ç–æ–º —É—Ç–∏–ª–∏—Ç–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –≤–∏–¥: **psexec ‚Äìs ‚Äìi ‚Äìd <–∫–æ–º–∞–Ω–¥–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏>**. –û–ø—Ü–∏—è ‚Äìs –ø—Ä–µ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–∞–ø—É—Å–∫ –æ—Ç –∏–º–µ–Ω–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –æ–ø—Ü–∏—è ‚Äìi –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Å–µ–∞–Ω—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º), –æ–ø—Ü–∏—è ‚Äìd –≥–æ–≤–æ—Ä–∏—Ç —É—Ç–∏–ª–∏—Ç–µ –Ω–µ –∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (—á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –∫–æ–Ω—Å–æ–ª—å, –≤ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª—Å—è –∑–∞–ø—É—Å–∫).

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é –æ–±–æ–ª–æ—á–∫—É —Å –ø—Ä–∞–≤–∞–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã **psexec ‚Äìs ‚Äìi ‚Äìd c:\windows\system32\cmd.exe**. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–π –æ–±–æ–ª–æ—á–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã **whoami** (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (28).png" alt=""><figcaption></figcaption></figure>

## –ò–∑—É—á–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –∫ –æ–±—ä–µ–∫—Ç–∞–º

### **–°–ø–∏—Å–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ –ø—Ä–∞–≤–∞**

–°–ø–∏—Å–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ (–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏—Ö –∑–∞–ø–∏—Å–∏) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–æ–º —Å—Å—ã–ª–æ–∫ (Security reference monitor ‚Äì SRM) –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —Å—É–±—ä–µ–∫—Ç–∞ –∫ –æ–±—ä–µ–∫—Ç—É. –ü—Ä–∏ —ç—Ç–æ–º –≤ —è–¥—Ä–µ –û–° –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Å–æ—Å—Ç–æ—è—â–∞—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (ACL) –∏ –∑–∞–ø–∏—Å–µ–π (ACCESS\_ALLOWED\_ACE –∏–ª–∏ ACCESS\_DENIED\_ACE). –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä ACL, ACCESS\_ALLOWED\_ACE –∏ ACCESS\_DENIED\_ACE –∏–∑ —Ñ–∞–π–ª–∞ winnt.h.

```c
typedef struct _ACL {
  BYTE AclRevision;
  BYTE Sbz1;
  WORD AclSize;
  WORD AceCount;
  WORD Sbz2;
} ACL;
typedef struct _ACCESS_ALLOWED_ACE {
  ACE_HEADER  Header;
  ACCESS_MASK Mask;
  DWORD       SidStart;
} ACCESS_ALLOWED_ACE;
typedef struct _ACCESS_DENIED_ACE {
  ACE_HEADER  Header;
  ACCESS_MASK Mask;
  DWORD       SidStart;
} ACCESS_DENIED_ACE;
```



–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ACE\_HEADER –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø ACE (–∫–∞–∫ –≤–∏–¥–Ω–æ ‚Äì –æ–±–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ACE —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ), –∞ —Ç–∞–∫–∂–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ ACE (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ).

–°–∞–º–∏ –ø—Ä–∞–≤–∞ –≤ ACE –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –±–∏—Ç–æ–≤–æ–π –º–∞—Å–∫–æ–π, –æ–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ.

<figure><img src=".gitbook/assets/image (65).png" alt=""><figcaption></figcaption></figure>

–î–ª—è –º–∞—Å–∫–∏ –ø—Ä–∞–≤ –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å 3 –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–ª–æ–∫–∞:

1\.       –û–±—â–∏–µ –ø—Ä–∞–≤–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å —Å–∞–º—ã—Ö —Ä–∞–Ω–Ω–∏—Ö –≤–µ—Ä—Å–∏–π Windows NT (GR, GW, GE, GA)

2\.       –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤ (Standard Access Rights)

3\.       –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã –¥–ª—è —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–Ω–æ—Å—è—Ç—Å—è –ø—Ä–∞–≤–∞ (—Ñ–∞–π–ª, –ø—Ä–æ—Ü–µ—Å—Å, —Å–æ–±—ã—Ç–∏–µ –∏ –ø—Ä.).

–ë–∏—Ç—ã –≤ –º–∞—Å–∫–µ –ø—Ä–∞–≤ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∞–≤–æ Generic All –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç, —á—Ç–æ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ —Ç–∞–∫–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç). –ü—Ä–∏ —ç—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –æ–±—ä–µ–∫—Ç—É –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –º–∞—Å–∫–µ.

–î–ª—è –æ–±—ä–µ–∫—Ç–æ–≤, —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã—Ö –º–µ–∂–¥—É —Å–µ–∞–Ω—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–ª–æ–≤ –∏ –∫–ª—é—á–µ–π —Ä–µ–µ—Å—Ç—Ä–∞) –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± ACL –≤–Ω–µ –ø–∞–º—è—Ç–∏ —è–¥—Ä–∞. –í —Å–ª—É—á–∞–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã NTFS ACL —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ $Secure, –∞ –≤ —Å–ª—É—á–∞–µ —Ä–µ–µ—Å—Ç—Ä–∞ ‚Äì –≤ —Å–∞–º–æ–º –¥–≤–æ–∏—á–Ω–æ–º —Ñ–∞–π–ª–µ —Ä–µ–µ—Å—Ç—Ä–∞.

### **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –ø–∞–º—è—Ç–∏ —è–¥—Ä–∞**

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ–∞–Ω—Å –æ—Ç–ª–∞–¥–∫–∏ —è–¥—Ä–∞ –û–° Windows.

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É **!object \GLOBAL??\C:** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–∞ —Ç–∏–ø–∞ SymbolicLink (**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** —É–∫–∞–∑–∞–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –æ–±—ä–µ–∫—Ç–∞–º —è–¥—Ä–∞, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è), —Å–æ–¥–µ—Ä–∂–∞—â–µ–≥–æ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ç–æ–º, –∫–æ—Ç–æ—Ä–æ–º—É –Ω–∞–∑–Ω–∞—á–µ–Ω –ª–æ–≥–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫ ¬´C:¬ª. –í –≤—ã–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞–π–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–∞ (ObjectHeader), —Å–º. —Ä–∏—Å—É–Ω–æ–∫.

<figure><img src=".gitbook/assets/image (55).png" alt=""><figcaption></figcaption></figure>

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É **dt nt!\_OBJECT\_HEADER <–∞–¥—Ä–µ—Å>** –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–∞ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–∏—Å–∫–∞ C:. –í –≤—ã–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞–π–¥–∏—Ç–µ –∞–¥—Ä–µ—Å Security Descriptor (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

–ê–±—Å–æ–ª—é—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –ø–æ–ª–µ SecurityDescriptor –±–µ–∑ —É—á–µ—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —á–µ—Ç—ã—Ä–µ—Ö –±–∏—Ç (—Ç.–µ. –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ –ø–æ–ª—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–Ω—É–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –Ω–∏–º–±–ª). –í—ã–≤–æ–¥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ SecurityDescriptor –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π **!sd <–∞–¥—Ä–µ—Å>** (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (42).png" alt=""><figcaption></figcaption></figure>

–í –≤—ã–≤–æ–¥–µ ACL –æ–±—ä–µ–∫—Ç–∞ –Ω–∞–π–¥–∏—Ç–µ Well-known SID, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –≥—Ä—É–ø–ø–µ Everyone (–≤—Å–µ)

–í –∫–æ–º–∞–Ω–¥–Ω–æ–π –æ–±–æ–ª–æ—á–∫–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É **set /P var=Input value > c:\out.txt**, –ø–æ—Å–ª–µ —á–µ–≥–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —É—Ç–∏–ª–∏—Ç—É Procexp64.exe –∏–∑ –ø–∞–∫–µ—Ç–∞ sysinternals –∏ –Ω–∞–π–¥–∏—Ç–µ –≤ –Ω–µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å cmd.exe. –í–∫–ª—é—á–∏—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞ (View ‚Üí Lower Pan View ‚Üí Handles). –ù–∞–π–¥–∏—Ç–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Ñ–∞–π–ª–∞ c:\out.txt –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤ (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (31).png" alt=""><figcaption></figcaption></figure>

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞ (–∞ —Ç–∞–∫–∂–µ –∫–æ–º–∞–Ω–¥—ã !object, dt –∏ !sd) –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ SecurityDescriptor‚Äô–∞ —Ñ–∞–π–ª–∞ —Å –ø–æ–º–æ—â—å—é –æ—Ç–ª–∞–¥—á–∏–∫–∞ —è–¥—Ä–∞:

1. –ù–∞–π–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–∞, —É–∫–∞–∑–∞–≤ –∫–æ–º–∞–Ω–¥—É **!object <–∞–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞>**
2. –í—ã–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É **nt!\_OBJECT\_HEADER <–∞–¥—Ä–µ—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞>**

–í –∫–æ–Ω–µ—á–Ω–æ–º —Å—á–µ—Ç–µ –≤—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–ª–µ–¥—É—é—â–∏–π –≤—ã–≤–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–∞:

<figure><img src=".gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

–ó–Ω–∞—á–µ–Ω–∏–µ null –≤ –ø–æ–ª–µ SecurityDescriptor —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç—É –≤—ã–Ω–µ—Å–µ–Ω–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –æ–±—ä–µ–∫—Ç–æ–≤ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –≤ –¥—Ä–∞–π–≤–µ—Ä —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã ‚Äì ntfs.sys).

### **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤**

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å NtObjectManager –¥–ª—è –æ–±–æ–ª–æ—á–∫–∏ PowerShell.

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥—É–ª—è NtObjectManager –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1\.       –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–¥—É–ª—å –ø–æ –æ–¥–Ω–æ–º—É –∏–∑ –ø—É—Ç–µ–π, –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π PSModulePath

2\.       –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ PowerShell –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª –º–æ–¥—É–ª—å —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã **Get-Module -ListAvailable**

3\.       –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã Import-Module.

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–æ–ª–æ—á–∫—É PowerShell. –í—ã–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π PSModulePath –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã **$Env:PSModulePath**. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ NtObjectManager (—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –ø–æ –ø—É—Ç–∏ C:\Utils) –≤ –æ–¥–∏–Ω –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π PSModulePath. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥ C:Program Files\WindowsPowerShell\Modules, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –û–°.

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É **Get-Module -ListAvailable** –∏ –Ω–∞–π–¥–∏—Ç–µ –≤ —Å–ø–∏—Å–∫–µ –º–æ–¥—É–ª—å NtObjectManager (—Å–º. –†–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (52).png" alt=""><figcaption></figcaption></figure>

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É **Import-Module -name NtObjectManager.** –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥ –æ–±—ä–µ–∫—Ç–æ–≤ –î–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã **cd NtObject:\\**. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç–µ –≤—ã–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã **dir** (—Å–º. –†–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

–î–ª—è –≤—ã–≤–æ–¥–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ–º–∞–Ω–¥–ª–µ—Ç Get-Acl. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É CdRom0 –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É: **Get-Acl \Device\CdRom0 | Format-List** (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (67).png" alt=""><figcaption></figcaption></figure>

–ù–∞–∏–±–æ–ª–µ–µ –ø–æ–ª–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ —Å—Ç—Ä–æ–∫–µ SDDL (Secure Descriptor Definition Language), –Ω–æ –¥–ª—è –µ–µ –ø—Ä–æ—á—Ç–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–Ω–∞—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SDDL –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–æ—Ä–æ–Ω–Ω—é—é —É—Ç–∏–ª–∏—Ç—É.

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Ç–∏–ª–∏—Ç—É SDDLViewer (—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ) –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫—É —Å SDDL –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º ACL. –í –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ –æ–∫–Ω–∞ —É—Ç–∏–ª–∏—Ç—ã –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ File and Directory Access Rights (—ç—Ç–æ –Ω–∞–∏–±–æ–ª–µ–µ –±–ª–∏–∑–∫–∏–π –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤ —É—Ç–∏–ª–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤ –æ–±—ä–µ–∫—Ç–∞), –ø–æ—Å–ª–µ —á–µ–≥–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É Make Report –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ ACL (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (38).png" alt=""><figcaption></figcaption></figure>

–ü—Ä–∏–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ACL –≤ –æ—Ç—á–µ—Ç–µ.

### **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ ACL –ø—Ä–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–æ–º –∫ –æ–±—ä–µ–∫—Ç–∞–º**

#### **–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è ACL –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Å–ø–∏—Å–∫–∞–º –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ä–µ—á—å –æ —Ñ–∞–π–ª–æ–≤–æ–º –æ–±—ä–µ–∫—Ç–µ, —Ç–æ –≤ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ CreateFile).

–ü—Ä–∏ —ç—Ç–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö ACL –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç—É —è–≤–Ω–æ, –∞ —Ç–∞–∫–∂–µ —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç –≤—ã—à–µ—Å—Ç–æ—è—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤. ACL, –∑–∞–ø—Ä–µ—â–∞—é—â–∏–µ –¥–æ—Å—Ç—É–ø (Deny ACL) –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ä–∞–Ω—å—à–µ ACL, —Ä–∞–∑—Ä–µ—à–∞—é—â–∏—Ö –¥–æ—Å—Ç—É–ø (Allow ACL).

–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–¥–µ—Ç—Å—è –¥–æ –ø–µ—Ä–≤–æ–≥–æ —Å—Ä–∞–±–æ—Ç–∞–≤—à–µ–≥–æ ACL (–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ SID –∏ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—É). –ï—Å–ª–∏ —ç—Ç–æ Deny ACL, —Ç–æ –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è, –µ—Å–ª–∏ Allow ACL ‚Äì —Ç–æ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è. –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–æ—à–µ–ª –Ω–∏ –æ–¥–∏–Ω ACL, —Ç–æ –¥–æ—Å—Ç—É–ø —Ç–∞–∫–∂–µ –∑–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è.

–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è ACL –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

1\.       –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É C:\Workspace.

2\.       –í —ç—Ç–æ–π –ø–∞–ø–∫–µ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª file.txt —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.

3\.       –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ç–∞–ª–æ–≥—É Workspace –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è User1 –¥–ª—è —á–µ–≥–æ –≤—ã–∑–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –∫–∞—Ç–∞–ª–æ–≥–∞ (–ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏), –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç ¬´Properties¬ª, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É ¬´Security¬ª, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´Advanced¬ª –∏ –≤ –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Effective Access (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

4\.       –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É ¬´Select a user¬ª –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (User1), –ø–æ—Å–ª–µ —á–µ–≥–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´View effective access¬ª (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (30).png" alt=""><figcaption></figcaption></figure>

5\.       –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥ —É—Ç–∏–ª–∏—Ç—ã, –∞ —Ç–∞–∫–∂–µ —Å–ø–∏—Å–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ C:\Workspace

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —É –ø–∞–ø–∫–∏ Workspace –≤—Å–µ ACL —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω—ã –æ—Ç –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ (C:\\). –û—Ç–∫–ª—é—á–∏—Ç–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ ACL —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–∫–∏ Disable Inheritance –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç ¬´Remove all inherited permissions from this object¬ª.

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –≤—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏–ª–∏ —Å–ø–∏—Å–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–∞—Ç–∞–ª–æ–≥–∞, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏–ª–∏ –º–µ–Ω—è—Ç—å –µ–≥–æ —Å–ø–∏—Å–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —è–≤–ª—è–µ—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –∫–∞—Ç–∞–ª–æ–≥–∞, –∞ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–¥–∞ ntfs.sys) –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤ (–≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ ‚Äì –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ACL).

#### **–ú–æ–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ ACL**

–ü—Ä–æ–≤–µ—Ä–∫–∞ ACL –≤ –û–° Windows –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –º–æ–º–µ–Ω—Ç —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –µ–≥–æ –∑–∞–ø—Ä–æ—Å–∏–≤—à–µ–≥–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ CreateFile (–Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Å–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Äì —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –ª—é–±–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É, –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è).

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è User1 –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É file.txt (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø —Å –ø–æ–º–æ—â—å—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞).

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é –æ–±–æ–ª–æ—á–∫—É –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è User1 (–≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —É—Ç–∏–ª–∏—Ç–æ–π **psexec** –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π **RunAs**). –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —ç—Ç–æ–π –æ–±–æ–ª–æ—á–∫–µ –∫–æ–º–∞–Ω–¥—É **pause >> file.txt**, –Ω–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ file.txt –ø–æ—è–≤–∏–ª–∞—Å—å —Å—Ç—Ä–æ–∫–∞ ¬´Press any key to continue . . .¬ª.

–ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —É–∫–∞–∑–∞–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É, –Ω–æ —Ç–µ–ø–µ—Ä—å –¥–æ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏ –∑–∞–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é User1 –∫ —Ñ–∞–π–ª—É file.txt (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —Ç–æ –¥–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–º–æ—â—å—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞). –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è User1, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ file.txt –ø–æ—è–≤–∏–ª–∞—Å—å –≤—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ ¬´Press any key to continue . . .¬ª. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –µ—â–µ —Ä–∞–∑ ‚Äì —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—Å—è –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É file.txt (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (24).png" alt=""><figcaption></figcaption></figure>

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç—É –∂–µ –æ–ø–µ—Ä–∞—Ü–∏—é, –∏—Å–ø–æ–ª—å–∑—É—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä notepad.exe. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ notepad –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç—ã–π —Ñ–∞–π–ª –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é User1 –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É.

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Ç–∏–ª–∏—Ç—É procmon –∏–∑ –ø–∞–∫–µ—Ç–∞ sysinternals. –ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Ñ–∏–ª—å—Ç—Ä—É procmon –¥–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É, –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—É—é –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ.

<figure><img src=".gitbook/assets/image (47).png" alt=""><figcaption></figcaption></figure>

–¢–∞–∫–∂–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä ¬´Operation is QueryDirectory then Exclude¬ª.

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–∞–±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É **pause >> file.txt** –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ notepad —Å —Ñ–∞–π–ª–æ–º file.txt. –ü—Ä–∏–≤–µ–¥–∏—Ç–µ –≤ –æ—Ç—á–µ—Ç–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É –≤ —Å–ª—É—á–∞–µ —Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º notepad.exe –Ω–µ —É–¥–∞–µ—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å —É–∂–µ –æ—Ç–∫—Ä—ã—Ç—ã–π —Ñ–∞–π–ª, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–æ—Å—Ç—É–ø –ø–æ—Å–ª–µ –µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –≤ —Ç–æ–º —á–∏—Å–ª–µ —Ç–µ—Ö, –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ç–æ—Ä—ã–º —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º –æ–±—ä–µ–∫—Ç–æ–≤.

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã RunAs —Ä–µ–¥–∞–∫—Ç–æ—Ä notepad.exe –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è User1 –∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Ç–∏–ª–∏—Ç—É procexp64 –∏–∑ –ø–∞–∫–µ—Ç–∞ sysinternals. –û—Ç–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (View ‚Üí Lower pane view ‚Üí Handles). –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–æ–π –ø—Ä–æ—Ü–µ—Å—Å –∏ –Ω–∞–π–¥–∏—Ç–µ —É –Ω–µ–≥–æ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞ Desktop —Å –∏–º–µ–Ω–µ–º \Default (—Å–º. —Ä–∏—Å—É–Ω–æ–∫)

<figure><img src=".gitbook/assets/image (69).png" alt=""><figcaption></figcaption></figure>

–° –ø–æ–º–æ—â—å—é –æ—Ç–ª–∞–¥—á–∏–∫–∞ —è–¥—Ä–∞ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É SECURITY DESCRIPTOR –∏ –¥–ª—è –Ω–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞.

–í –æ–∫–Ω–µ —Å–≤–æ–π—Å—Ç–≤ –æ–±—ä–µ–∫—Ç–∞ —É—Ç–∏–ª–∏—Ç—ã Procexp64 –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É ¬´Security¬ª –∏ –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–ø—Ä–µ—â–∞—é—â–∏–π ACL –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è User1.

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–Ω–µ–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –±–ª–æ–∫–Ω–æ—Ç –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç.

–ü–æ–ø—ã—Ç–∞–π—Ç–µ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ—â–µ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –±–ª–æ–∫–Ω–æ—Ç –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è User1 ‚Äì –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π.

<figure><img src=".gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ–ø–µ—Ä—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–∞–≤ —Ñ–∞–π–ª–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è User1 –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Å–µ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∏ Workspace). –¢–∞–∫ –∫–∞–∫ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç—É, —Ç–æ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–µ–∫—É—â–∏–µ —Å–ø–∏—Å–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è User1 –∞–∫—Ç–∏–≤–Ω–∞ –æ–ø—Ü–∏—è —Å–º–µ–Ω—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞ (—Å–º. —Ä–∏—Å—É–Ω–æ–∫).

<figure><img src=".gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

–°–º–µ–Ω–∏—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ User1 –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É.

## 2.2         –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–Ω—è—Ç–∏–µ. –£–ø–∞–∫–æ–≤–∫–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Universal Windows Platform

## –£–ø–∞–∫–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ImageMagick –≤ AppContainer (UWP)

–î–ª—è —É–ø–∞–∫–æ–≤–∫–∏ ImageMagick –≤ UWP –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è [MSIX Packaging Tool](https://learn.microsoft.com/en-us/windows/msix/packaging-tool/tool-overview).

–° –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å msix-–ø–∞–∫–µ—Ç –∏–∑ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ msi- –∏–ª–∏ exe- —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã.

–î–ª—è —É–ø–∞–∫–æ–≤–∫–∏ –±—ã–ª –≤—ã–±—Ä–∞–Ω –≤–∞—Ä–∏–∞–Ω—Ç ImageMagick —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –ª–∏–Ω–∫–æ–≤–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ([ImageMagick-7.1.0-52-Q8-x64-static.exe](https://imagemagick.org/archive/binaries/ImageMagick-7.1.0-52-Q8-x64-static.exe)).

#### –®–∞–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–∫–µ—Ç–∞:

1\.       –í—ã–±—Ä–∞—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é Application Package\


<figure><img src=".gitbook/assets/image (66).png" alt=""><figcaption></figcaption></figure>

2\.       –í—ã–±—Ä–∞—Ç—å ‚ÄúCreate package on this computer‚Äù\


<figure><img src=".gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

3\.       –í—ã–±—Ä–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ ImageMagick.

<figure><img src=".gitbook/assets/image (56).png" alt=""><figcaption></figcaption></figure>

4\.       –ó–∞–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—â–µ–≥–æ MSIX-–ø–∞–∫–µ—Ç–∞. –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ImageMagick.

5\.       –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–∞–∫–µ—Ç–∞.\


<figure><img src=".gitbook/assets/image (61).png" alt=""><figcaption></figcaption></figure>

6\.       –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞–∫–µ—Ç\


<figure><img src=".gitbook/assets/image (58).png" alt=""><figcaption></figcaption></figure>

## –ü—Ä–æ–±–ª–µ–º—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–∞–∫–µ—Ç–∞ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### **–ü—Ä–æ–±–ª–µ–º–∞ 1:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω–æ

<figure><img src=".gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** —Å–æ–∑–¥–∞—Ç—å self-signed pfx —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ ([https://docs.microsoft.com/ru-ru/windows/msix/package/create-certificate-package-signing](https://docs.microsoft.com/ru-ru/windows/msix/package/create-certificate-package-signing)).  –ó–∞—Ç–µ–º –ø–æ–¥–ø–∏—Å–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é MSIX Packaging Tool.

<figure><img src=".gitbook/assets/image (46).png" alt=""><figcaption></figcaption></figure>

–¢–µ–ø–µ—Ä—å –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–∏—Å—Ç–µ–º—ã.

### **–ü—Ä–æ–±–ª–µ–º–∞ 2:** –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ ‚Äúmagick‚Äù

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –ø–∞–∫–µ—Ç–∞ (AppxManifest.xml) —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–≥—Ä–∞–º–º—ã —É–ø–∞–∫–æ–≤–∫–∏.

<figure><img src=".gitbook/assets/image (50).png" alt=""><figcaption></figcaption></figure>

–í –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω (—Ç–µ–≥ ‚ÄúPackage‚Äù) xmlns:uap5=[http://schemas.microsoft.com/appx/manifest/uap/windows10/5](http://schemas.microsoft.com/appx/manifest/uap/windows10/5)\
–ê —Ç–∞–∫ –∂–µ –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∞–ª–∏–∞—Å–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:

_\<uap5:Extension Category="windows.appExecutionAlias" Executable="VFS\ProgramFilesX64\ImageMagick-7.0.10-Q16\magick.exe" EntryPoint="Windows.FullTrustApplication">_\
&#x20;         _\<uap5:AppExecutionAlias>_\
&#x20;           _\<uap5:ExecutionAlias Alias="magick.exe" />_\
&#x20;         _\</uap5:AppExecutionAlias>_\
&#x20;       _\</uap5:Extension>_

Executable ‚Äì –ø—É—Ç—å –¥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –º—ã —Å–æ–∑–¥–∞–µ–º –∞–ª–∏–∞—Å

EntryPoint ‚Äì —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –∞–ª–∏–∞—Å–∞

Alias ‚Äì –∞–ª–∏–∞—Å –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø–∞–∫–µ—Ç.

## –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1\.       –í –º–µ–Ω—é ¬´–ü—É—Å–∫¬ª –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –ø—É–Ω–∫—Ç ‚ÄúImageMagick Display‚Äù\


<figure><img src=".gitbook/assets/image (34).png" alt=""><figcaption></figcaption></figure>

2\.       –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –µ–≥–æ –∑–∞–ø—É—Å–∫

3\.      –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

<figure><img src=".gitbook/assets/image (59).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (41).png" alt=""><figcaption></figcaption></figure>

4\.       –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –Ω–µ–º—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é

<figure><img src=".gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

5\.       –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª

<figure><img src=".gitbook/assets/image (18).png" alt=""><figcaption></figcaption></figure>

6\.       –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ

<figure><img src=".gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ

1\.       –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ –∫–æ–º–∞–Ω–¥–µ ‚Äúmagick‚Äù. –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é\


<figure><img src=".gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

2\.      –ü—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è PNG –≤ JPG\


<figure><img src=".gitbook/assets/image (35).png" alt=""><figcaption></figcaption></figure>

3\.       –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ\


<figure><img src=".gitbook/assets/image (20).png" alt=""><figcaption></figcaption></figure>

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

1\.       –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ UWP TaskMonitor, –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤ –º–∞–≥–∞–∑–∏–Ω–µ Windows.

2\.       –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ ImageMagick –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –µ–≥–æ –≤ —Å–ø–∏—Å–∫–µ. –¢–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Packaged.

<figure><img src=".gitbook/assets/image (29).png" alt=""><figcaption></figcaption></figure>

–î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç —Å –ø–æ–º–æ—â—å—é API Windows.System.Diagnostics.ProcessDiagnosticInfo ([https://blogs.windows.com/windowsdeveloper/2017/06/28/uwp-app-diagnostics/](https://blogs.windows.com/windowsdeveloper/2017/06/28/uwp-app-diagnostics/))

## 2.3         –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–Ω—è—Ç–∏–µ. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Å–º–∞—Ä—Ç-–∫–∞—Ä—Ç–µ. –ü–æ–ª–∏—Ç–∏–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞ (Device Guard)

–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª .vmx –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã Windows 10 –∏ –ø—Ä–æ–ø–∏—Å–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è UEFI Secure Boot:\


```shell
firmware = "efi"
uefi.secureBoot.enabled = "TRUE"
uefi.allowAuthBypass = "TRUE"
```

–î–æ–±–∞–≤–∏—Ç—å TPM –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É.

–°–æ–∑–¥–∞—Ç—å —Ç–µ–Ω–µ–≤—É—é –∫–æ–ø–∏—é –¥–∏—Å–∫–∞ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥:

```powershell
 $s1 = (gwmi -List Win32_ShadowCopy).Create("C:\","ClientAccessible")
 $s2 = gwmi Win32_ShadowCopy | ? { $_.ID -eq $s1.ShadowID }
 $d  = $s2.DeviceObject + "\"
 cmd /c mklink /d C:\scpy "$d"
```

–û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–Ω–∏–º–æ–∫ –¥–∏—Å–∫–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å xml-—Ñ–∞–π–ª —Å –ø–æ–¥–ø–∏—Å—è–º–∏ –∏ —Ö—ç—à-–∫–æ–¥–∞–º–∏ –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤:

```powershell
New-CIPolicy -Level PcaCertificate -Fallback Hash -FilePath C:\BasePolicy.xml -ScanPath C:\scpy -UserPEs
```

### –¢–µ–º –≤—Ä–µ–º–µ–Ω–µ–º... Windows Server 2016

### [Active Directory Certificate Services](#user-content-fn-1)[^1]

–ü—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫—É Active Directory

–í—ã–±—Ä–∞—Ç—å [Tools -> Active Directory Users and Computers](#user-content-fn-2)[^2]

* –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É –¥–æ–º–µ–Ω–∞ –∏ –æ—Ç–∫—Ä—ã—Ç—å Users
* –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
* –ö–ª–∏–∫–Ω—É—Ç—å –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –∏ –≤—ã–±—Ä–∞—Ç—å Properties
* –í—ã–±—Ä–∞—Ç—å –≤–∫–ª–∞–¥–∫—É Member Of
* –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É Add‚Ä¶ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É IIS\_IUSRS

–î–∞–ª–µ–µ –≤—ã–±—Ä–∞—Ç—å [Manage -> Add Roles and Features](#user-content-fn-3)[^3]

–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–º–µ—Ç–∫–∏ –≤ –ø–æ–ª—è—Ö:

* [Active Directory -> Certificate Enrollment Policy Web Server](#user-content-fn-4)[^4]
* [Active Directory -> Certificate Enrollment Web Server](#user-content-fn-5)[^5]

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π Manage[^6] –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Ñ–ª–∞–∂–æ–∫\
–í—ã–±—Ä–∞—Ç—å configure [Active Directory Certificate Services](#user-content-fn-7)[^7]\
–ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–æ–ª–µ–π –≤—ã–±—Ä–∞—Ç—å:

* [Certificate Enrollment Policy Web Server](#user-content-fn-8)[^8]
* [Certificate Enrollment Web Server](#user-content-fn-9)[^9]

–£–∫–∞–∑–∞—Ç—å CA, –≤—ã–±—Ä–∞–≤ ‚ÄúCA name‚Äù\
–í—ã–±—Ä–∞—Ç—å —Ç–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ User name and password \
–£–∫–∞–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç, –≤—ã–±—Ä–∞–≤ select –∏ –≤–≤–µ–¥—è –¥–∞–Ω–Ω—ã–µ —Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∞–Ω–µ–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤ –≥—Ä—É–ø–ø—É IIS\_IUSRS\
–°–Ω–æ–≤–∞ –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ User name and password\
–î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### [Internet Information Services Manager](#user-content-fn-10)[^10]

* –û—Ç–∫—Ä—ã—Ç—å Server Manager
* –í—ã–±—Ä–∞—Ç—å [Tools -> Internet Information Services Manager](#user-content-fn-11)[^11]
* –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –¥–æ–º–µ–Ω
* –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ Sites&#x20;
* –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ Default Web Site
* –í—ã–±—Ä–∞—Ç—å —á–∞—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Å—Ç—Ä–æ–∫—É ‚ÄúADPolicyProvider\_CEP‚Äú
* –í —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –≤—ã–±—Ä–∞—Ç—å [Application Settings](#user-content-fn-12)[^12]&#x20;
* –£–∫–∞–∑–∞—Ç—å FriendlyName
* –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å URI –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≥–¥–µ-—Ç–æ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

* –û—Ç–∫—Ä—ã—Ç—å Server Manager
* –í—ã–±—Ä–∞—Ç—å [Tools -> Internet Information Services Manager](#user-content-fn-13)[^13]
* –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –¥–æ–º–µ–Ω
* –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ Sites
* –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ Default Web Site
* –í—ã–±—Ä–∞—Ç—å Bindings...[^14] -> https -> Edit... -> –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### [Group Policy Management](#user-content-fn-15)[^15]

* –û—Ç–∫—Ä—ã—Ç—å Server Manager
* –í—ã–±—Ä–∞—Ç—å [Tools -> Group Policy Management](#user-content-fn-16)[^16]
* –û—Ç–∫—Ä—ã—Ç—å [Forest:Domain.com -> Domains -> DOMAIN.com ](#user-content-fn-17)[^17]
* –ü—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ DOMAIN.local –∏ –≤—ã–±—Ä–∞—Ç—å \
  [‚ÄúCreate a GPO in this domain, and link it here‚Äù](#user-content-fn-18)[^18]
* –í –ø–æ–ª–µ Name –≤–≤–µ—Å—Ç–∏ –∏–º—è –æ–±—ä–µ–∫—Ç–∞ –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏
* –ù–∞–∂–∞—Ç—å –û–ö
* –ö–ª–∏–∫–Ω—É—Ç—å –ø–æ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É
* –ü—Ä–∏ –≤—ã–≤–æ–¥–µ –æ—à–∏–±–∫–∏ –∫–ª–∏–∫–Ω—É—Ç—å –û–ö
* –ö–ª–∏–∫–Ω—É—Ç—å –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –ø–æ –Ω–æ–≤–æ–º—É —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É –∏ –≤—ã–±—Ä–∞—Ç—å Edit...
* –û—Ç–∫—Ä—ã—Ç—å \
  [User Configuration -> Policies -> Windows Settings -> Security Settings -> Public Key Policy](#user-content-fn-19)[^19]
* –î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ \
  [Certificate Services Client - Certificate Enrollment Policy](#user-content-fn-20)[^20]
* –í–∫–ª—é—á–∏—Ç—å –º–æ–¥–µ–ª—å
* –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É Add‚Ä¶&#x20;
* –í –ø–æ–ª–µ URI –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–æ—Ç URI, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–æ–º–Ω–∏–ª–∏ —Ä–∞–Ω–µ–µ
* –í –ø–æ–ª–µ [Autentication type](#user-content-fn-21)[^21] –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø Username/password&#x20;
* –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É Validate Server
* –í–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* –î–æ–∂–¥–∞—Ç—å—Å—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ù–∞–∂–∞—Ç—å Add

### –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ Smartcard

–û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–∑–∞–ø—É—Å—Ç–∏—Ç—å mm—Å) –≤ —Ä–µ–∂–∏–º–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞&#x20;

–í—ã–±—Ä–∞—Ç—å –≤–∫–ª–∞–¥–∫—É [File -> Add/Remove Snap-in](#user-content-fn-22)[^22]&#x20;

–í—ã–±—Ä–∞—Ç—å –≤ —Å–ø–∏—Å–∫–µ [Certificate Templates](#user-content-fn-23)[^23] –∏ [Certification Authority](#user-content-fn-24)[^24], –Ω–∞–∂–∞—Ç—å Add

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –≤—ã–±—Ä–∞—Ç—å Local Computer. –ù–∞–∂–∞—Ç—å –û–ö

–ù–∞ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –¥–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ [Certificate Templates](#user-content-fn-25)[^25]

–ù–∞–π—Ç–∏ –≤ —Å–ø–∏—Å–∫–µ Smartcard Logon, \
–∫–ª–∏–∫–Ω—É—Ç—å –ø–æ –Ω–µ–π –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –∏ –≤—ã–±—Ä–∞—Ç—å Duplicate Template

–û—Ç–∫—Ä–æ—é—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞

–í–æ –≤–∫–ª–∞–¥–∫–µ Compatibility[^26] —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å [Certification authority](#user-content-fn-27)[^27] –∏ [Certificate recipient](#user-content-fn-28)[^28]\
–í–æ –≤–∫–ª–∞–¥–∫–µ General —É–∫–∞–∑–∞—Ç—å –∏–º—è —à–∞–±–ª–æ–Ω–∞\
–í–æ –≤–∫–ª–∞–¥–∫–µ [Request Handling](#user-content-fn-29)[^29] —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Purpose –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ [Signature and smartcard login](#user-content-fn-30)[^30] –∏ –≤—ã–±—Ä–∞—Ç—å [Prompt the user during enrollment](#user-content-fn-31)[^31] \
–í–æ –≤–∫–ª–∞–¥–∫–µ Cryptography —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–ª—é—á–∞ 2048 –∏ –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ [Requests must use one of the following providers](#user-content-fn-32)[^32], –≤—ã–±—Ä–∞–≤ \
`Microsoft Base Smart Card Crypto Provider`\
–í–æ –≤–∫–ª–∞–¥–∫–µ Security –¥–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, [Authenticated Users](#user-content-fn-33)[^33]) –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, —É–∫–∞–∑–∞–≤ –∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é. [Allow -> Enroll](#user-content-fn-34)[^34]\
–ù–∞–∂–∞—Ç—å –û–ö

–í –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞–π—Ç–∏ [Certificate Templates](#user-content-fn-35)[^35] \
–∫–ª–∏–∫–Ω—É—Ç—å –ø—Ä–∞–≤–æ–π –∫–ª–∞–≤–∏—à–µ–π -> New -> [Certificate Template to Issue](#user-content-fn-36)[^36]

–í—ã–±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª —Å–æ–∑–¥–∞–Ω. –ù–∞–∂–∞—Ç—å –û–ö

–í –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∫–ª–∏–∫–Ω—É—Ç—å –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –ø–æ –∏–º–µ–Ω–∏ CA –∏ –Ω–∞–∂–∞—Ç—å -> All tasks  -> Stop Service –∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Start Service –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞

### Windows 10

### Device Guard Part

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π XML-—Ñ–∞–π–ª –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º–Ω—É—é –ø–∞–ø–∫—É **C:\Windows\System32\CodeIntegrity\\**

```powershell
ConvertFrom-CIPolicy C:\BasePolicy.xml C:\SIPolicy.bin 
cp C:\SIPolicy.bin c:\Windows\System32\CodeIntegrity\SIPolicy.p7b 
```

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –º–µ—Ö–∞–Ω–∏–∑–º Code Integrity –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç—É –≤ —Ä–µ–∂–∏–º–µ –∞—É–¥–∏—Ç–∞. –ü—Ä–æ–≤–µ—Ä–∏–≤ –∑–∞–ø—É—Å–∫ –∏ —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º, –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –¥–∞–Ω–Ω—ã–º–∏, —Å–æ–±—Ä–∞–Ω–Ω—ã–º–∏ –∞—É–¥–∏—Ç–æ–º, –≤—ã–ø–æ–ª–Ω–∏–≤ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É

```powershell
New-CIPolicy -Level PcaCertificate -Fallback Hash C:\AuditPolicy.xml -Audit
```

–ö–ª—é—á _-Audit_ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ –∞—É–¥–∏—Ç–∞.\
–§–∞–π–ª AuditPolicy.xml –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ñ–∞–π–ª—É BasePolicy.xml, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Ä–∞–Ω–µ–µ.\
–î–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–æ–±—Ä–∞–Ω–Ω–æ–π –≤ —Ä–µ–∂–∏–º–µ –∞—É–¥–∏—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∫–æ–º–∞–Ω–¥–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫

```powershell
Merge-CIPolicy ‚ÄìOutputFilePath C:\Final.xml ‚ÄìPolicyPaths C:\ BasePolicy.xml,C:\AuditPolicy.xml
```

–ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏, –≤ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –æ—Ç–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –∞—É–¥–∏—Ç–∞

```powershell
Set-RuleOption -Option 3 -FilePath C:\Final.xml -Delete
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —É–¥–∞–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å _Enabled:Audit Mode_ –∏–∑ XML-—Ñ–∞–π–ª–∞, –∏ —Ç–∞–∫–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë –Ω–µ—É—á—Ç–µ–Ω–Ω–æ–µ –≤ –Ω–µ–π –ü–û.\
–î–∞–ª–µ–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º XML-—Ñ–∞–π–ª –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, —Å–Ω–æ–≤–∞ –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É

```powershell
ConvertFrom-CIPolicy C:\Final.xml C:\SIPolicy.bin
```

–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –Ω–∞ —Ü–µ–ª–µ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –º–æ–∂–Ω–æ –∫–∞–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–≤ —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º —Ñ–∞–π–ª **SIPolicy.bin**, —Ç–∞–∫ –∏ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏—Å—å –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π Windows 10 –≤ —Ä–∞–∑–¥–µ–ª–µ **Computer Configuration\Administrative Templates\System\Device Guard**

### SmartCard part

–£ –∞–¥–∞–ø—Ç–µ—Ä–∞ –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö IPv4 —É–∫–∞–∑–∞—Ç—å –≤ –ø–æ–ª–µ –∞–¥—Ä–µ—Å DNS —Å–µ—Ä–≤–µ—Ä–∞ –∞–¥—Ä–µ—Å Windows Server 2016

–û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. \
–í—ã–±—Ä–∞—Ç—å System and Security -> System\
–í —á–∞—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–∞–±–æ—á–µ–π –≥—Ä—É–ø–ø—ã –Ω–∞–∂–∞—Ç—å ‚ÄúChange settings‚Äù\
–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞ –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ Change\
–í—ã–±—Ä–∞—Ç—å –¥–æ–º–µ–Ω DOMAIN.local\
–í–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\
–î–æ–∂–¥–∞—Ç—å—Å—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã

–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –ª–æ–∫–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ (–ù–∞–ø—Ä–∏–º–µ—Ä —Å –ø–æ–º–æ—â—å—é win+r -> gpedit.msc)\
–ü–µ—Ä–µ–π—Ç–∏ –≤ Computer Configuration -> Administrative Templates -> System ->Device Guard\
–î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ [Turn On Virtualization Based Security](#user-content-fn-37)[^37]\
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É, –≤—ã–±—Ä–∞–≤ Enabled\
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Credential Guard Configuration –≤ –∑–Ω–∞—á–µ–Ω–∏–µ Enabled with UEFI lock\
–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–∞–∂–∞–≤ OK

{% hint style="info" %}
–í —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Windows –æ—Ç–∫—Ä—ã—Ç—å –ü—Ä–æ–≥—Ä–∞–º–º—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ù–∞–ø—Ä–∏–º–µ—Ä —Å –ø–æ–º–æ—â—å—é win+r -> appwiz.cpl) \
–í –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞–π—Ç–∏ Turn Windows features on or off. –ù–∞–π—Ç–∏ Isolated User Mode –∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞–ø—Ä–æ—Ç–∏–≤ –Ω–µ–≥–æ –≥–∞–ª–æ—á–∫—É. –ù–∞–∂–∞—Ç—å OK. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—à–∏–Ω—É
{% endhint %}

–û—Ç–∫—Ä—ã—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–º TPM (–ù–∞–ø—Ä–∏–º–µ—Ä —Å –ø–æ–º–æ—â—å—é win+r -> tpm.msc)\
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –µ–≥–æ —Å—Ç–∞—Ç—É—Å ‚Äúready for use‚Äù\
–ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–∞–∫, —Ç–æ –≤ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ –Ω–∞–∂–∞—Ç—å Prepare the TPM, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—à–∏–Ω—É –∏ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–¥—É–ª—è TPM

–û—Ç–∫—Ä—ã—Ç—å –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ä–µ–∂–∏–º–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.\
–í–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É

```powershell
tpmvscmgr.exe create /name mycard /pin PROMPT /adminkey DEFAULT /puk PROMPT /generate
```

–í–≤–µ—Å—Ç–∏ PIN, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å\
–í–≤–µ—Å—Ç–∏ PUK, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å\
–ü—Ä–∏ —ç—Ç–æ–º Admin key –±—É–¥–µ—Ç —Ç–∞–∫–∏–º\
`010203040506070801020304050607080102030405060708`\
–î–æ–∂–¥–∞—Ç—å—Å—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Å–º–∞—Ä—Ç –∫–∞—Ä—Ç—ã\
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–Ω–∞ —Å–æ–∑–¥–∞–ª–∞—Å—å, —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã

<pre class="language-powershell"><code class="lang-powershell"><strong>wmic path win32_PnPEntity where ‚ÄúDeviceID like ‚Äò%smartcardreader%‚Äô‚Äù get DeviceID,Name,Status
</strong></code></pre>

–û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤(–Ω–∞–ø—Ä–∏–º–µ—Ä —Å –ø–æ–º–æ—â—å—é win+r -> certmgr.msc)\
–í—ã–±—Ä–∞—Ç—å Active Directory Enrollment Policy\
–í —Å–ø–∏—Å–∫–µ —à–∞–±–ª–æ–Ω–æ–≤ –≤—ã–±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è —Å–º–∞—Ä—Ç –∫–∞—Ä—Ç—ã\
–ù–∞–∂–∞—Ç—å Enroll\
–í–≤–µ—Å—Ç–∏ PIN\
–î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –Ω–∞–∂–∞—Ç—å Finish

–û—Ç–∫—Ä—ã—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ù–∞–ø—Ä–∏–º–µ—Ä —Å –ø–æ–º–æ—â—å—é win+r -> secpol.msc)

{% hint style="info" %}
–ò–ª–∏ –≥—Ä—É–ø–ø–æ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ–º–µ–Ω–∞ (gpmc.msc) –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
{% endhint %}

–ü–µ—Ä–µ–π—Ç–∏ –≤ Security Settings -> Local Policies -> Security Options\
–ù–∞–π—Ç–∏ Interactive logon: Require smart card –∏ –¥–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω—É—Ç—å\
–í—ã–±—Ä–∞—Ç—å Enabled\
–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∞—à–∏–Ω—É, —Ç–µ–ø–µ—Ä—å –≤—Ö–æ–¥ –≤ —É—á—ë—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ —Å–º–∞—Ä—Ç –∫–∞—Ä—Ç–µ

[^1]: –°–ª—É–∂–±—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Active Directory

[^2]: –°—Ä–µ–¥—Å—Ç–≤–∞ -> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã Active Directory

[^3]: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -> –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

[^4]: –°–ª—É–∂–±—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Active Directory -> –í–µ–±-—Å–ª—É–∂–±–∞ –ø–æ–ª–∏—Ç–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

[^5]: –°–ª—É–∂–±—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Active Directory -> –í–µ–±-—Å–ª—É–∂–±–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

[^6]: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

[^7]: –°–ª—É–∂–±—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Active Directory

[^8]: –í–µ–±-—Å–ª—É–∂–±–∞ –ø–æ–ª–∏—Ç–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

[^9]: –í–µ–±-—Å–ª—É–∂–±–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

[^10]: –î–∏—Å–ø–µ—Ç—á–µ—Ä —Å–ª—É–∂–± IIS

[^11]: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -> –î–∏—Å–ø–µ—Ç—á–µ—Ä —Å–ª—É–∂–± IIS

[^12]: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

[^13]: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -> –î–∏—Å–ø–µ—Ç—á–µ—Ä —Å–ª—É–∂–± IIS

[^14]: –ü—Ä–∏–≤—è–∑–∫–∏...

[^15]: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π

[^16]: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ->  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π

[^17]: –õ–µ—Å:–¥–æ–º–µ–Ω.com -> –î–æ–º–µ–Ω—ã -> –¥–æ–º–µ–Ω.com

[^18]: "–°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ —ç—Ç–æ–º –¥–æ–º–µ–Ω–µ –∏ —Å–≤—è–∑–∞—Ç—å –µ–≥–æ..."

[^19]: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -> –ü–æ–ª–∏—Ç–∏–∫–∏ -> –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Windows -> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -> –ü–æ–ª–∏—Ç–∏–∫–∏ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∫–ª—é—á–∞

[^20]: –ö–ª–∏–µ–Ω—Ç —Å–ª—É–∂–± —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: –ø–æ–ª–∏—Ç–∏–∫–∞  —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

[^21]: –¢–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

[^22]: –§–∞–π–ª -> –î–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –æ—Å–Ω–∞—Å—Ç–∫—É...

[^23]: –®–∞–±–ª–æ–Ω—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

[^24]: –¶–µ–Ω—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

[^25]: –®–∞–±–ª–æ–Ω—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

[^26]: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

[^27]: –¶–µ–Ω—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

[^28]: –ü–æ–ª—É—á–∞—Ç–µ–ª—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

[^29]: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞

[^30]: –í—Ö–æ–¥ —Å –ø–æ–¥–ø–∏—Å—å—é –∏ —Å–º–∞—Ä—Ç-–∫–∞—Ä—Ç–æ–π

[^31]: –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

[^32]: –í –∑–∞–ø—Ä–æ—Å–∞—Ö –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫

[^33]: –ü—Ä–æ—à–µ–¥—à–∏–µ –ø—Ä–æ–≤–µ—Ä–∫—É

[^34]: –†–∞–∑—Ä–µ—à–∏—Ç—å -> –ó–∞—è–≤–∫–∞

[^35]: –®–∞–±–ª–æ–Ω—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

[^36]: –í—ã–¥–∞–≤–∞–µ–º—ã–π —à–∞–±–ª–æ–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

[^37]: –í–∫–ª—é—á–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
